#include "stdint.h"
#define PMSM_SINTABLESIZE	80
#define CPU_Freq 168000000 
#define PWM_Freq 100000    
#define MOD_Freq 50  

#define steps  (PWM_Freq/MOD_Freq)
#define precision (CPU_Freq/PWM_Freq/8)
#define pi  3.1415926535
void sinus_init(void);
unsigned int sin_ar[steps];

//static const uint16_t SIN_TAB_0[PMSM_SINTABLESIZE] = 
//{
//2048 ,
//2190 ,
//2333 ,
//2473 ,
//2612 ,
//2748 ,
//2880 ,
//3009 ,
//3133 ,
//3251 ,
//3364 ,
//3470 ,
//3569 ,
//3661 ,
//3745 ,
//3821 ,
//3888 ,
//3946 ,
//3995 ,
//4035 ,
//4064 ,
//4084 ,
//4094 ,
//4094 ,
//4084 ,
//4064 ,
//4035 ,
//3995 ,
//3946 ,
//3888 ,
//3821 ,
//3745 ,
//3661 ,
//3569 ,
//3470 ,
//3364 ,
//3251 ,
//3133 ,
//3009 ,
//2880 ,
//2748 ,
//2612 ,
//2473 ,
//2333 ,
//2190 ,
//2048 ,
//1905 ,
//1762 ,
//1622 ,
//1483 ,
//1347 ,
//1215 ,
//1086 ,
//962 ,
//844 ,
//731 ,
//625 ,
//526 ,
//434 ,
//350 ,
//274 ,
//207 ,
//149 ,
//100 ,
//60 ,
//31 ,
//11 ,
//1 ,
//1 ,
//11 ,
//31 ,
//60 ,
//100 ,
//149 ,
//207 ,
//274 ,
//350 ,
//434 ,
//526 ,
//625 ,
//731 ,
//844 ,
//962 ,
//1086 ,
//1215 ,
//1347 ,
//1483 ,
//1622 ,
//1762 ,
//1905 ,
//2047 ,




//};

//static const uint16_t SIN_TAB_120[PMSM_SINTABLESIZE] = 
//{
//3821 ,
//3746 ,
//3662 ,
//3570 ,
//3470 ,
//3364 ,
//3252 ,
//3133 ,
//3009 ,
//2881 ,
//2748 ,
//2612 ,
//2474 ,
//2333 ,
//2191 ,
//2048 ,
//1905 ,
//1763 ,
//1622 ,
//1483 ,
//1347 ,
//1215 ,
//1086 ,
//962 ,
//844 ,
//731 ,
//625 ,
//526 ,
//434 ,
//350 ,
//274 ,
//207 ,
//149 ,
//100 ,
//60 ,
//31 ,
//11 ,
//1 ,
//1 ,
//11 ,
//31 ,
//60 ,
//100 ,
//149 ,
//207 ,
//274 ,
//349 ,
//433 ,
//525 ,
//625 ,
//731 ,
//843 ,
//962 ,
//1086 ,
//1214 ,
//1347 ,
//1483 ,
//1621 ,
//1762 ,
//1904 ,
//2047 ,
//2190 ,
//2332 ,
//2473 ,
//2612 ,
//2748 ,
//2880 ,
//3009 ,
//3133 ,
//3251 ,
//3364 ,
//3470 ,
//3569 ,
//3661 ,
//3745 ,
//3821 ,
//3888 ,
//3946 ,
//3995 ,
//4035 ,
//4064 ,
//4084 ,
//4094 ,
//4094 ,
//4084 ,
//4064 ,
//4035 ,
//3995 ,
//3946 ,
//3888 ,
//3821 ,
//};
static const uint16_t SIN_TAB[PMSM_SINTABLESIZE][8] = 
{
{2048, 3496, 4095, 3496, 2048, 600,  0, 599}, 
{2208, 3605, 4089, 3378, 1887, 491,  6, 717}, 
{2368, 3704, 4070, 3252, 1728, 391,  25, 843}, 
{2526, 3794, 4039, 3118, 1570, 302,  56, 977}, 
{2680, 3872, 3995, 2978, 1415, 223,  100, 1117}, 
{2831, 3940, 3940, 2832, 1264, 156,  155, 1263}, 
{2977, 3995, 3872, 2681, 1118, 100,  222, 1414}, 
{3118, 4039, 3794, 2526, 978, 56,  301, 1569}, 
{3251, 4070, 3705, 2368, 844, 25,  390, 1726}, 
{3378, 4089, 3605, 2209, 718, 6,  490, 1886}, 
{3496, 4095, 3496, 2048, 600, 0,  599, 2047}, 
{3605, 4089, 3378, 1887, 490, 6,  717, 2207}, 
{3704, 4070, 3251, 1727, 391, 25,  843, 2367}, 
{3794, 4039, 3118, 1570, 302, 56,  977, 2525}, 
{3872, 3995, 2977, 1415, 223, 100,  1117, 2680}, 
{3940, 3940, 2831, 1264, 156, 155,  1263, 2830}, 
{3995, 3872, 2681, 1118, 100, 222,  1414, 2977}, 
{4039, 3794, 2526, 978, 56, 301,  1569, 3117}, 
{4070, 3704, 2368, 844, 25, 390,  1726, 3251}, 
{4089, 3605, 2208, 718, 6, 490,  1886, 3377}, 
{4096, 3496, 2048, 600, 0, 599,  2047, 3495}, 
{4089, 3378, 1887, 490, 6, 717,  2207, 3604}, 
{4070, 3251, 1727, 391, 25, 843,  2367, 3704}, 
{4039, 3118, 1570, 301, 56, 977,  2525, 3793}, 
{3995, 2977, 1415, 223, 100, 1117,  2680, 3872}, 
{3940, 2831, 1264, 156, 155, 1263,  2831, 3939}, 
{3872, 2680, 1118, 100, 223, 1414,  2977, 3995}, 
{3794, 2526, 978, 56, 301, 1569,  3117, 4039}, 
{3704, 2368, 844, 25, 390, 1727,  3251, 4070}, 
{3605, 2208, 718, 6, 490, 1886,  3377, 4089}, 
{3496, 2048, 600, 0, 599, 2047,  3495, 4095}, 
{3378, 1887, 490, 6, 717, 2208,  3604, 4089}, 
{3251, 1727, 391, 25, 843, 2367,  3704, 4070}, 
{3118, 1570, 301, 56, 977, 2525,  3793, 4039}, 
{2977, 1415, 223, 100, 1117, 2680,  3872, 3996}, 
{2831, 1264, 155, 155, 1263, 2831,  3939, 3940}, 
{2680, 1118, 100, 223, 1414, 2977,  3995, 3873}, 
{2526, 978, 56, 301, 1569, 3117,  4039, 3794}, 
{2368, 844, 25, 390, 1727, 3251,  4070, 3705}, 
{2208, 718, 6, 490, 1886, 3377,  4089, 3605}, 
{2048, 599, 0, 599, 2047, 3495,  4095, 3496}, 
{1887, 490, 6, 717, 2208, 3604,  4089, 3378}, 
{1727, 391, 25, 843, 2367, 3704,  4070, 3252}, 
{1569, 301, 56, 977, 2525, 3793,  4039, 3118}, 
{1415, 223, 100, 1117, 2680, 3872,  3995, 2978}, 
{1264, 155, 155, 1263, 2831, 3939,  3940, 2832}, 
{1118, 100, 223, 1414, 2977, 3995,  3873, 2681}, 
{977, 56, 301, 1569, 3117, 4039,  3794, 2526}, 
{844, 25, 390, 1727, 3251, 4070,  3705, 2369}, 
{717, 6, 490, 1886, 3377, 4089,  3605, 2209}, 
{599, 0, 599, 2047, 3495, 4095,  3496, 2048}, 
{490, 6, 717, 2208, 3605, 4089,  3378, 1888}, 
{391, 25, 844, 2368, 3704, 4070,  3252, 1728}, 
{301, 56, 977, 2525, 3793, 4039,  3118, 1570}, 
{223, 100, 1118, 2680, 3872, 3995,  2978, 1415}, 
{155, 155, 1264, 2831, 3939, 3940,  2832, 1265}, 
{100, 223, 1414, 2977, 3995, 3873,  2681, 1118}, 
{56, 301, 1569, 3117, 4039, 3794,  2526, 978}, 
{25, 391, 1727, 3251, 4070, 3705,  2369, 844}, 
{6, 490, 1887, 3377, 4089, 3605,  2209, 718}, 
{0, 599, 2047, 3495, 4095, 3496,  2048, 600}, 
{6, 717, 2208, 3605, 4089, 3378,  1888, 491}, 
{25, 844, 2368, 3704, 4070, 3252,  1728, 391}, 
{56, 977, 2525, 3794, 4039, 3118,  1570, 302}, 
{100, 1118, 2680, 3872, 3995, 2978,  1415, 223}, 
{155, 1264, 2831, 3939, 3940, 2832,  1264, 156}, 
{223, 1415, 2977, 3995, 3872, 2681,  1118, 100}, 
{301, 1569, 3117, 4039, 3794, 2526,  978, 56}, 
{391, 1727, 3251, 4070, 3705, 2368,  844, 25}, 
{490, 1887, 3377, 4089, 3605, 2209,  718, 6}, 
{599, 2047, 3495, 4095, 3496, 2048,  600, 0}, 
{717, 2208, 3605, 4089, 3378, 1887,  491, 6}, 
{844, 2368, 3704, 4070, 3252, 1728,  391, 25}, 
{977, 2525, 3794, 4039, 3118, 1570,  302, 56}, 
{1118, 2680, 3872, 3995, 2978, 1415,  223, 99}, 
{1264, 2831, 3940, 3940, 2832, 1264,  156, 155}, 
{1415, 2977, 3995, 3872, 2681, 1118,  100, 222}, 
{1569, 3117, 4039, 3794, 2526, 978,  56, 301}, 
{1727, 3251, 4070, 3705, 2368, 844,  25, 390}, 
{1887, 3377, 4089, 3605, 2209, 718,  6, 490}, 




};





#define PMSM_SINTABLESIZE2	192
static const uint8_t PMSM_SINTABLE2 [PMSM_SINTABLESIZE2][3] =
{
		{0,       0,      221},
		{8,       0,      225},
		{17,      0,      229},
		{25,      0,      232},
		{33,      0,      236},
		{42,      0,      239},
		{50,      0,      241},
		{58,      0,      244},
		{66,      0,      246},
		{74,      0,      248},
		{82,      0,      250},
		{90,      0,      252},
		{98,      0,      253},
		{105,     0,      254},
		{113,     0,      254},
		{120,     0,      255},
		{128,     0,      255},
		{135,     0,      255},
		{142,     0,      254},
		{149,     0,      254},
		{155,     0,      253},
		{162,     0,      252},
		{168,     0,      250},
		{174,     0,      248},
		{180,     0,      246},
		{186,     0,      244},
		{192,     0,      241},
		{197,     0,      239},
		{202,     0,      236},
		{207,     0,      232},
		{212,     0,      229},
		{217,     0,      225},
		{221,     0,      221},
		{225,     0,      217},
		{229,     0,      212},
		{232,     0,      207},
		{236,     0,      202},
		{239,     0,      197},
		{241,     0,      192},
		{244,     0,      186},
		{246,     0,      180},
		{248,     0,      174},
		{250,     0,      168},
		{252,     0,      162},
		{253,     0,      155},
		{254,     0,      149},
		{254,     0,      142},
		{255,     0,      135},
		{255,     0,      127},
		{255,     0,      120},
		{254,     0,      113},
		{254,     0,      105},
		{253,     0,      98},
		{252,     0,      90},
		{250,     0,      82},
		{248,     0,      74},
		{246,     0,      66},
		{244,     0,      58},
		{241,     0,      50},
		{239,     0,      42},
		{236,     0,      33},
		{232,     0,      25},
		{229,     0,      17},
		{225,     0,      8},
		{221,     0,      0},
		{225,     8,      0},
		{229,     17,     0},
		{232,     25,     0},
		{236,     33,     0},
		{239,     42,     0},
		{241,     50,     0},
		{244,     58,     0},
		{246,     66,     0},
		{248,     74,     0},
		{250,     82,     0},
		{252,     90,     0},
		{253,     98,     0},
		{254,     105,    0},
		{254,     113,    0},
		{255,     120,    0},
		{255,     127,    0},
		{255,     135,    0},
		{254,     142,    0},
		{254,     149,    0},
		{253,     155,    0},
		{252,     162,    0},
		{250,     168,    0},
		{248,     174,    0},
		{246,     180,    0},
		{244,     186,    0},
		{241,     192,    0},
		{239,     197,    0},
		{236,     202,    0},
		{232,     207,    0},
		{229,     212,    0},
		{225,     217,    0},
		{221,     221,    0},
		{217,     225,    0},
		{212,     229,    0},
		{207,     232,    0},
		{202,     236,    0},
		{197,     239,    0},
		{192,     241,    0},
		{186,     244,    0},
		{180,     246,    0},
		{174,     248,    0},
		{168,     250,    0},
		{162,     252,    0},
		{155,     253,    0},
		{149,     254,    0},
		{142,     254,    0},
		{135,     255,    0},
		{128,     255,    0},
		{120,     255,    0},
		{113,     254,    0},
		{105,     254,    0},
		{98,      253,    0},
		{90,      252,    0},
		{82,      250,    0},
		{74,      248,    0},
		{66,      246,    0},
		{58,      244,    0},
		{50,      241,    0},
		{42,      239,    0},
		{33,      236,    0},
		{25,      232,    0},
		{17,      229,    0},
		{8,       225,    0},
		{0,       221,    0},
		{0,       225,    8},
		{0,       229,    17},
		{0,       232,    25},
		{0,       236,    33},
		{0,       239,    42},
		{0,       241,    50},
		{0,       244,    58},
		{0,       246,    66},
		{0,       248,    74},
		{0,       250,    82},
		{0,       252,    90},
		{0,       253,    98},
		{0,       254,    105},
		{0,       254,    113},
		{0,       255,    120},
		{0,       255,    128},
		{0,       255,    135},
		{0,       254,    142},
		{0,       254,    149},
		{0,       253,    155},
		{0,       252,    162},
		{0,       250,    168},
		{0,       248,    174},
		{0,       246,    180},
		{0,       244,    186},
		{0,       241,    192},
		{0,       239,    197},
		{0,       236,    202},
		{0,       232,    207},
		{0,       229,    212},
		{0,       225,    217},
		{0,       221,    221},
		{0,       217,    225},
		{0,       212,    229},
		{0,       207,    232},
		{0,       202,    236},
		{0,       197,    239},
		{0,       192,    241},
		{0,       186,    244},
		{0,       180,    246},
		{0,       174,    248},
		{0,       168,    250},
		{0,       162,    252},
		{0,       155,    253},
		{0,       149,    254},
		{0,       142,    254},
		{0,       135,    255},
		{0,       128,    255},
		{0,       120,    255},
		{0,       113,    254},
		{0,       105,    254},
		{0,       98,     253},
		{0,       90,     252},
		{0,       82,     250},
		{0,       74,     248},
		{0,       66,     246},
		{0,       58,     244},
		{0,       50,     241},
		{0,       42,     239},
		{0,       33,     236},
		{0,       25,     232},
		{0,       17,     229},
		{0,       8,      225}
};
